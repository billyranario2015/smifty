$(function(){function t(){var t=$("#filler").val(),a=$("#"+t).val(),e="media-url";$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:e,fieldname:t,value:a},success:function(t){$("#dashboard-notice").text("Settings saved...").show(),setTimeout(function(){$("#dashboard-notice").hide()},3e3)},error:function(t){console.log(t.responseText)}})}function a(t){$("#dashboard-notice").text(t).show(),setTimeout(function(){$("#dashboard-notice").hide()},3e3)}var e=3;$("#jobname").keyup(function(){var t=$("#jobname").val(),a=$(this).attr("data-usertype");t.length>=e&&$.ajax({dataType:"json",type:"post",url:"/ajax/autocomplete.php",data:{keyword:t,usertype:a},success:function(t){""==t?($("#emptyfood").show(),$("#add-a-food").show()):($("#foodsearchresults").empty().show(),$.each(t,function(t,a){$("#foodsearchresults").append($("<option></option>").attr({value:a.id,"data-restaurant":a.name,"data-amount":a.amount,"data-name":a.foodname}).text(a.foodname))}),$("#foodactions button").click(function(t){var a=$(this).attr("data-intent"),e=$(this).attr("data-target");"delete"==a&&$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{foodid:e,intent:"delete"},success:function(t){$("#foodsearchresults option[value="+e+"]").remove(),$(".foodactions").hide(),$("#foodsearchresults").hide(),$("#jobname").val(""),$("#foodalert").show().text("Food item successfully deleted")},error:function(t){}})}),$("#foodsearchresults option").click(function(t){t.preventDefault(),$(".foodactions").show();var a=$(this).val(),e=$(this).attr("data-restaurant"),o=$(this).attr("data-amount"),n=$(this).attr("data-name");$(".resta .val").text(e),$(".name .val").text(n),$(".amount .val").text(o),$("#foodactions button").attr("data-target",a)}))},error:function(t){console.log(t)}})}),$("#restaurantname").keyup(function(){var t=$("#restaurantname").val(),a=$(this).attr("data-usertype");t.length>=e&&$.ajax({dataType:"json",type:"post",url:"/ajax/autocomplete.php",data:{keyword:t,usertype:a,table:"restaurant"},success:function(t){console.log(t),""==t?($("#emptyrestaurant").show(),$("#add-a-restaurant").show()):($("#restaurantsearchresults").empty().show(),$.each(t,function(t,a){$("#restaurantsearchresults").append($("<option></option>").attr({value:a.id,"data-name":a.name,"data-city":a.city,"data-logo":a.logo,"data-phone":a.phone}).text(a.name))}),$("#restaurantactions button").click(function(t){var a=$(this).attr("data-intent"),e=$(this).attr("data-target"),o=$(this).attr("data-for");"delete"==a&&$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{restaurantid:e,intent:"delete",table:o},success:function(t){$("#restaurantsearchresults option[value="+e+"]").remove(),$(".restaurantactions").hide(),$("#restaurantsearchresults").hide(),$("#restaurantname").val(""),$("#restaurantalert").show().text("Restaurant successfully deleted")},error:function(t){}})}),$("#restaurantsearchresults option").click(function(t){t.preventDefault(),$(".restaurantactions").show();var a=$(this).val(),e=$(this).attr("data-name"),o=$(this).attr("data-city"),n=$(this).attr("data-logo"),s=$(this).attr("data-address"),r=$(this).attr("data-phone"),d=$(this).attr("data-email");$(".resta .val").text(e),$(".city .val").text(o),$(".logo .val").text(n),$("#restaurantactions button").attr("data-target",a)}))},error:function(t){}})}),$("#add-a-food").click(function(t){var a=$("#jobname").val();$("#newfoodbox").show(),$("#newfoodname").val(a),$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:"getrestaurants"},success:function(t){$.each(t,function(t,a){$("#restaurantlist").append($("<option></option>").attr("value",a.id).text(a.name))})},error:function(t){}})}),$("#add-a-restaurant").click(function(t){var a=$("#restaurantname").val();$("#addrestaurant-b").show(),$("#newretaurantname").val(a),$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:"getcities"},success:function(t){console.log(t),$.each(t,function(t,a){$("#citylist").append($("<option></option>").attr("value",a.id).text(a.cityname))})},error:function(t){console.log(t.responseText)}})}),$("#add-food-form").submit(function(t){t.preventDefault();var a={name:$("#newfoodname").val(),restaurant:$("#restaurantlist").find(":selected").val(),amount:$("#foodamount").val(),vegetarian:$("#vegetarian").find(":checked").val(),available:$("#available").find(":checked").val()};$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:"addnewfood",dataform:a},encode:!0,success:function(t){$("#newfoodbox").hide(),$("#emptyfood").hide(),$("#jobname").val(""),$("#foodalert").show().text("Food item successfully added to the database")},error:function(t){}})}),$("#add-restaurant-form").submit(function(t){t.preventDefault();var a={name:$("#newretaurantname").val(),city:$("#citylist").find(":selected").val(),address:$("#restaddress").val(),phone:$("#restphone").val(),email:$("#restemail").val()};$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:"addnewrestaurant",dataform:a},encode:!0,success:function(t){$("#addrestaurant-b").hide(),$("#restaurantname").val(""),$("#emptyrestaurant").hide(),$("#restaurantsearchresults").hide(),$("#restaurantalert").show().text("Restaurant successfully added")},error:function(t){}})});var o,n=800;$("#fb_url, #twit_url, #pint_url, #google_url").keyup(function(){$("#filler").val($(this).attr("id")),clearTimeout(o),o=setTimeout(t,n)}),$("#fb_url, #twit_url, #pint_url, #google_url").keydown(function(){clearTimeout(o)}),$(".media-url-trigger button").click(function(t){var a=$(this).attr("data-type"),e=$(this).attr("data-value");$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:"media-active",fieldname:a,value:e},success:function(t){$("#dashboard-notice").text("Settings saved...").show(),setTimeout(function(){$("#dashboard-notice").hide()},3e3)},error:function(t){console.log(t.responseText)}})}),$("#currencySelector").on("change",function(t){var e=$("#currencySelector option:selected").val(),o="Currency successfully changed";console.log(e),$.ajax({type:"post",dataType:"json",url:"/ajax/dashboard-actions.php",data:{intent:"update-field",table:"settings",fieldname:"fieldname",rowname:"currency",valuefield:"value",value:e},success:function(t){a(o)},error:function(t){console.log(t.responseText)}})})});